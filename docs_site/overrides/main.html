{% extends "base.html" %}

{% block extrahead %}
  {{ super() }}
  {# Inject version between logo and search using JavaScript #}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var logoLink = document.querySelector('.wy-side-nav-search > a');
      var searchDiv = document.querySelector('.wy-side-nav-search div[role="search"]');
      if (logoLink && searchDiv && logoLink.parentNode) {
        // Create version div
        var versionDiv = document.createElement('div');
        versionDiv.className = 'inline-version';
        versionDiv.style.cssText = 'text-align:center; margin:8px 0;';
        
        // Read version HTML from template file
        {% set version_html %}{% include "partials/version_inline.html" %}{% endset %}
        {% set version_js = version_html|replace('"', '\\"')|replace('\n', ' ')|replace('\r', '')|trim %}
        versionDiv.innerHTML = "{{ version_js }}";
        
        // Insert between logo and search (after the logo link, before search)
        logoLink.parentNode.insertBefore(versionDiv, searchDiv);
      }
      
      // Fix navigation links for local file:// protocol
      // Convert directory links (ending with /) to index.html links
      if (window.location.protocol === 'file:') {
        var navLinks = document.querySelectorAll('.wy-menu a.reference.internal');
        navLinks.forEach(function(link) {
          var href = link.getAttribute('href');
          if (href && href.endsWith('/') && !href.endsWith('/index.html')) {
            // Convert ../troubleshooting/ to ../troubleshooting/index.html
            link.setAttribute('href', href + 'index.html');
          } else if (href && !href.includes('#') && !href.includes('.html') && !href.startsWith('#') && href !== '.') {
            // Handle links that don't have .html extension and aren't anchors
            if (!href.endsWith('/')) {
              link.setAttribute('href', href + '/index.html');
            }
          }
        });
      }
    });
  </script>
{% endblock %}

{% block footer %}
<footer>
  <hr/>
  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>
  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  <br>
  <span class="footer-8bit">co-written with a robot ü§ñ‚ù§Ô∏è</span>
</footer>
{% endblock %}
